import{c as e,u as t,r as a,j as s,B as r}from"./index-B2XvNDaG.js";import{u as i,a as n,L as o,t as l,o as d,s as c}from"./index-L-31gmIX.js";import{i as m}from"./axiosClient-Bl7wR9qs.js";import{u}from"./useMutation-BG0cvSJV.js";import{I as x}from"./input-Drd92ogd.js";import{C as p,a as h,d as f,e as g,b}from"./card-CJZ17ex6.js";function j(e={}){const{mutation:t={},client:a={}}=e??{},{client:s,...r}=t,i=r.mutationKey??[{url:"/api/auth/resend-otp"}];return u({mutationFn:async({data:e})=>async function(e,t={}){const{client:a=m,...s}=t;return await a({method:"POST",url:"/api/auth/resend-otp",data:e,...s,headers:{"Content-Type":"application/*+json",...s.headers}})}(e,a),mutationKey:i,...r},s)}function w(e={}){const{mutation:t={},client:a={}}=e??{},{client:s,...r}=t,i=r.mutationKey??[{url:"/api/auth/verify-otp"}];return u({mutationFn:async({data:e})=>async function(e,t={}){const{client:a=m,...s}=t;return await a({method:"POST",url:"/api/auth/verify-otp",data:e,...s,headers:{"Content-Type":"application/*+json",...s.headers}})}(e,a),mutationKey:i,...r},s)}const k=d({otp:c().length(6,"OTP harus terdiri dari 6 digit").regex(/^\d{6}$/,"OTP harus berupa angka")}),v=e("/ForgotPassword/VerifikasiOtp/")({component:function(){const e=i({resolver:n(k),defaultValues:{otp:""}}),d=t(),c=localStorage.getItem("resetPasswordEmail")||"",m=a.useRef([]),[u,v]=a.useState(300),{mutate:y,isPending:N,isSuccess:P}=w({mutation:{onSuccess:e=>{l.success("OTP Valid!",{description:e.message||"OTP Anda valid, silakan masukkan password baru."}),d({to:"/ForgotPassword/SetNewPassword"})},onError:e=>{l.error("Verifikasi Gagal",{description:e.message||"Terjadi kesalahan saat memverifikasi OTP."})}}}),{mutate:T,isPending:O}=j({mutation:{onSuccess:e=>{l.success("OTP Baru Dikirim",{description:e.message||"Kode OTP baru telah dikirim ke email Anda."}),v(300)},onError:e=>{l.error("Gagal Mengirim OTP",{description:e.message||"Terjadi kesalahan saat mengirim ulang OTP."})}}});return a.useEffect(()=>{m.current[0]?.focus()},[]),a.useEffect(()=>{if(0===u)return;const e=setTimeout(()=>{v(e=>Math.max(0,e-1))},1e3);return()=>clearTimeout(e)},[u]),s.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 sm:p-6",children:s.jsxs(p,{className:"w-full max-w-md shadow-xl rounded-2xl border-0 bg-white/90 backdrop-blur-sm",children:[s.jsxs(h,{className:"text-center px-6 pt-8 pb-4",children:[s.jsx("div",{className:"mx-auto bg-blue-100 p-3 rounded-full w-16 h-16 flex items-center justify-center mb-4",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-blue-600",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 7h2a2 2 0 012 2v6a2 2 0 01-2 2h-2m-4 0H9a2 2 0 01-2-2V9a2 2 0 012-2h2m-4 6h.01M15 11h.01"})})}),s.jsx(f,{className:"text-2xl sm:text-3xl font-bold text-gray-800",children:"Verifikasi OTP"}),s.jsxs(g,{className:"mt-2 text-gray-600 text-sm sm:text-base",children:["Masukkan 6 digit kode yang dikirim ke ",s.jsx("span",{className:"font-semibold text-blue-600 break-all",children:c||"email Anda"})]})]}),s.jsxs(b,{className:"px-6 pb-8",children:[s.jsxs("form",{onSubmit:e.handleSubmit(e=>{y({data:{email:c,otp:e.otp}})}),className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx("div",{className:"grid grid-cols-6 gap-2 sm:gap-3 mb-2",children:[...Array(6)].map((t,a)=>s.jsx(x,{ref:e=>m.current[a]=e,value:e.watch("otp")[a]||"",onChange:t=>((t,a)=>{if(/^\d$/.test(a)||""===a){const s=e.getValues("otp").split("");s[t]=a,e.setValue("otp",s.join(""),{shouldValidate:!0}),a&&t<5&&m.current[t+1]?.focus()}})(a,t.target.value),onKeyDown:t=>((t,a)=>{"Backspace"===a.key&&t>0&&!e.getValues("otp")[t]&&m.current[t-1]?.focus()})(a,t),type:"text",inputMode:"numeric",maxLength:1,autoComplete:"one-time-code",className:"h-14 sm:h-16 w-full text-center text-2xl font-bold border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 shadow-sm",placeholder:"0",disabled:P},a))}),e.formState.errors.otp&&s.jsx("p",{className:"mt-2 text-sm text-red-500 text-center",children:e.formState.errors.otp.message})]}),s.jsxs("div",{className:"flex flex-col gap-3",children:[s.jsx(r,{type:"submit",disabled:N||P,className:"w-full py-6 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-medium rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl",children:N?s.jsxs(s.Fragment,{children:[s.jsx(o,{className:"mr-2 h-5 w-5 animate-spin"}),"Memverifikasi..."]}):P?"OTP Valid":"Verifikasi OTP"}),s.jsxs("div",{className:"flex items-center justify-center gap-2",children:[s.jsx(r,{type:"button",variant:"ghost",onClick:()=>{c&&0===u&&T({data:{email:c}})},disabled:O||u>0,className:"py-5 text-blue-600 font-medium hover:text-blue-800 hover:bg-blue-50 "+(u>0||O?"opacity-50 cursor-not-allowed":""),children:O?s.jsxs(s.Fragment,{children:[s.jsx(o,{className:"mr-2 h-4 w-4 animate-spin"}),"Mengirim..."]}):"Kirim Ulang OTP"}),u>0&&s.jsxs("span",{className:"text-sm text-gray-500",children:["(",(e=>{const t=Math.floor(e/60),a=e%60;return`${t}:${a<10?"0":""}${a}`})(u),")"]})]})]})]}),P&&s.jsxs("div",{className:"mt-6 p-4 bg-green-50 border border-green-200 rounded-xl text-green-700 text-center animate-fade-in",children:[s.jsxs("p",{className:"font-medium flex items-center justify-center gap-2",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"OTP valid!"]}),s.jsx("p",{className:"text-sm mt-1",children:"Mengarahkan ke halaman reset password..."})]})]})]})})}});export{v as Route};
